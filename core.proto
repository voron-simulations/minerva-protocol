syntax = "proto3";

package Minerva.Protocol;

import "common.proto";
import "group.proto";
import "commands.proto";
import "zone.proto";

// Request for subscribing to state updates
message UpdateSubscribeRequest {
  repeated string update_types = 1; // "simulation", "group", "zone" - empty means all types
  optional string side_id = 2; // Filter updates by side (optional)
}

// Union of all possible state update messages
message StateUpdateMessage {
  oneof update {
    SimulationStateUpdate simulation_update = 1;
    GroupStateUpdate group_update = 2;
    ZoneStateUpdate zone_update = 3;
  }
}

service MessageExchangeService {
  // Query operations
  rpc ListGroups(ListGroupsRequest) returns (ListGroupsResponse);
  rpc GetGroupState(GroupStateUpdateRequest) returns (GroupStateUpdate);
  rpc ListZones(ListZonesRequest) returns (ListZonesResponse);
  rpc GetZone(GetZoneRequest) returns (GetZoneResponse);
  
  // Command operations
  rpc SendMoveCommand(MoveCommandRequest) returns (MoveCommandResponse);
  rpc SendSearchAndDestroyCommand(SearchAndDestroyCommandRequest) returns (SearchAndDestroyCommandResponse);
  rpc SendDefendZoneCommand(DefendZoneCommandRequest) returns (DefendZoneCommandResponse);
  rpc SendPatrolCommand(PatrolCommandRequest) returns (PatrolCommandResponse);
  rpc SendSupportCommand(SupportCommandRequest) returns (SupportCommandResponse);
  
  // State update subscription
  rpc SubscribeToUpdates(UpdateSubscribeRequest) returns (stream StateUpdateMessage);
}
